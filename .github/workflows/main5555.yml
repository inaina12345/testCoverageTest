name: Switch Branch and Diff

on:
  push:
    branches:
      - main

jobs:
  switch-branch-and-diff:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Switch to target branch and run git diff
      run: |
        set -e
        branchName="update_metadata"
        # releaseブランチへのマージPR用ブランチへのチェックアウト
        git checkout -b ${branchName}
        # メタデータ差分ファイル一覧テキスト削除
        if [ -e metadata_diff.txt ]; then
          rm metadata_diff.txt
        fi
        # AppStoreメタデータ情報の差分ファイル一覧出力
        # 一時ファイルに差分を保存
        temp_diff_file=$(mktemp)
        git diff --name-only > "$temp_diff_file"
        # AppStoreメタデータ情報の差分ファイル一覧出力
        grep "fastlane/metadata" "$temp_diff_file" > metadata_diff.txt
        # 一時ファイルを削除
        rm "$temp_diff_file"
        cat metadata_diff.txt
